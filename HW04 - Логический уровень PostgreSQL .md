<b>Домашнее задание 04: Логический уровень PostgreSQL</b>

Цель:
создание новой базы данных, схемы и таблицы

создание роли для чтения данных из созданной схемы созданной базы данных

создание роли для чтения и записи из созданной схемы созданной базы данных


Описание/Пошаговая инструкция выполнения домашнего задания:

создайте новый кластер PostgresSQL 14
зайдите в созданный кластер под пользователем postgres
создайте новую базу данных testdb
зайдите в созданную базу данных под пользователем postgres
создайте новую схему testnm
создайте новую таблицу t1 с одной колонкой c1 типа integer
вставьте строку со значением c1=1
создайте новую роль readonly
дайте новой роли право на подключение к базе данных testdb
дайте новой роли право на использование схемы testnm
дайте новой роли право на select для всех таблиц схемы testnm
создайте пользователя testread с паролем test123
дайте роль readonly пользователю testread
зайдите под пользователем testread в базу данных testdb
сделайте select * from t1;
получилось? (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже)
напишите что именно произошло в тексте домашнего задания
у вас есть идеи почему? ведь права то дали?
посмотрите на список таблиц
подсказка в шпаргалке под пунктом 20
а почему так получилось с таблицей (если делали сами и без шпаргалки то может у вас все нормально)
вернитесь в базу данных testdb под пользователем postgres
удалите таблицу t1
создайте ее заново но уже с явным указанием имени схемы testnm
вставьте строку со значением c1=1
зайдите под пользователем testread в базу данных testdb
сделайте select * from testnm.t1;
получилось?
есть идеи почему? если нет - смотрите шпаргалку
как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку
сделайте select * from testnm.t1;
получилось?
есть идеи почему? если нет - смотрите шпаргалку
сделайте select * from testnm.t1;
получилось?
ура!
теперь попробуйте выполнить команду create table t2(c1 integer); insert into t2 values (2);
а как так? нам же никто прав на создание таблиц и insert в них под ролью readonly?
есть идеи как убрать эти права? если нет - смотрите шпаргалку
если вы справились сами то расскажите что сделали и почему, если смотрели шпаргалку - объясните что сделали и почему выполнив указанные в ней команды
теперь попробуйте выполнить команду create table t3(c1 integer); insert into t2 values (2);
расскажите что получилось и почему

# Выполнение
Создана ВМ в Яндекс облаке, сгенерирован SSH ключ. Подключение к ВМ через Putty и установка на нее PostgreSQL 17 через sudo apt:

sudo apt update && sudo DEBIAN_FRONTEND=noninteractive apt upgrade -y -q && sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list' && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add - && sudo apt-get update && sudo DEBIAN_FRONTEND=noninteractive apt -y install postgresql-17

pg_lsclusters

![1 - Создали новый кластер PostgresSQL 17 и подключились к нему](https://github.com/user-attachments/assets/b3413703-2274-468b-8a4b-c872f987e09a)

<br><b>Далее по заданию:</b>
<br>•	зайдите в созданный кластер под пользователем postgres
<br>•	создайте новую базу данных testdb
<br>•	зайдите в созданную базу данных под пользователем postgres
<br>•	создайте новую схему testnm
<br>•	создайте новую таблицу t1 с одной колонкой c1 типа integer
<br>•	вставьте строку со значением c1=1
<br>
![2 - Создали БД testdb и в ней таблицу t1, заполнили таблицу t1 значением](https://github.com/user-attachments/assets/7c0989e8-db0d-48e2-ad07-d8995e2bc1e1)


<br><b>Далее по заданию:</b>
<br>•	создайте новую роль readonly
<br>•	дайте новой роли право на подключение к базе данных testdb
<br>•	дайте новой роли право на использование схемы testnm
<br>•	дайте новой роли право на select для всех таблиц схемы testnm
<br>•	создайте пользователя testread с паролем test123
<br>•	дайте роль readonly пользователю testread
<br>
![3 - Создали новую роль readonly, пользователя testread и дали права](https://github.com/user-attachments/assets/36eeda41-3d4d-4a00-952f-e19635c563d9)


<br><b>Далее по заданию:</b>
<br>• зайдите под пользователем testread в базу данных testdb
<br>•	сделайте select * from t1;
<br>•	получилось? (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже)
<br>•	напишите что именно произошло в тексте домашнего задания
<br>•	у вас есть идеи почему? ведь права то дали?
<br>•	посмотрите на список таблиц
<br><b>ОТВЕТ: Нет, т.к. нет доступа на select для схемы public (в которой создана таблица t1), дали доступ на схему testnm.</b> 
<br>Подключение к базе testdb под пользователем testread производил командой:
<br>sudo -u postgres  psql -U testread -h 127.0.0.1 -W -d testdb
<br>пришлось указать, что используется подключение по сети 127.0.0.1, т.к. файл pg_hba.conf не менял.
<br>
![4 - Подключились под пользователем testread в базу данных testdb и попробовали сделать select](https://github.com/user-attachments/assets/eeb7a664-3ccf-490f-941d-790c3d2a7f59)


<br><b>Далее по заданию:</b>
<br>• вернитесь в базу данных testdb под пользователем postgres
<br>•	удалите таблицу t1
<br>•	создайте ее заново но уже с явным указанием имени схемы testnm
<br>•	вставьте строку со значением c1=1
<br>•	зайдите под пользователем testread в базу данных testdb
<br>•	сделайте select * from testnm.t1;
<br>•	получилось?
<br><b>ОТВЕТ: Нет, т.к. доступ на select всех таблиц схемы testnm для роли readonly был дан только для существующих на тот момент времени таблиц, а затем таблицу testnm.t1 пересоздали.</b> 
<br>
![5 - Сделал по заданиям 22-27](https://github.com/user-attachments/assets/27937b88-c3d3-4c98-8586-d25d9c433a01)


<br><b>Далее по заданию:</b>
<br>• как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку
<br>•	сделайте select * from testnm.t1;
<br>•	получилось?
<br><b>ОТВЕТ: Да, т.к. дал повторно доступ на select всех таблиц схемы testnm для роли readonly. Командой:</b>
<br>grant SELECT on all TABLEs in SCHEMA testnm TO readonly
<br>
![6 - Сделал по заданиям 27-36](https://github.com/user-attachments/assets/9632dbe8-a6cd-4c71-ad3e-419b3e4adc9a)


<br><b>Далее по заданию:</b>
<br>• теперь попробуйте выполнить команду create table t2(c1 integer); insert into t2 values (2);
<br>•	а как так? нам же никто прав на создание таблиц и insert в них под ролью readonly?
<br><b>ОТВЕТ: Выполнить команду create table t2 не даёт, т.к. права на CREATE TABLE убраны (использую 17 версию Postgres).</b>
<br>
![7 - Выполнить команду create table t2 не даёт, т к  права на CREATE TABLE убраны (используем 17 версию)](https://github.com/user-attachments/assets/7e3bd062-aec9-4000-86a1-5f7c86ecbb1c)



<br><b>Далее не по заданию:</b>
<br>Решил дать доступ на создание объектов и таблиц пользователю testread на схему testnm, чтобы пользователь смог сам создать таблицы. Использовал команды:
<br>
<b>Привилегии CREATE, чтобы пользователь смог создавать новые объекты внутри схемы:</b>
<br>GRANT CREATE ON SCHEMA testnm TO testread;
<br><b>Дал пользователю testread доступ на создание таблиц в схеме testnm:</b>
<br>GRANT ALL ON ALL TABLES IN SCHEMA testnm TO testread;
<br>Создал таблицу testnm.t2 под пользователем testread
<br>
![8 - Дал права на создание объектов в базе юзеру testread и создал под ним таблицу t2](https://github.com/user-attachments/assets/c886fabc-4346-47fe-9d68-a4f90a6f8342)


<br>А так же создал таблицу testnm.t3 под пользователем testread и вставил записиь в testnm.t1
<br>
![9 - создал таблицу t3 и вставил запсиь в t1](https://github.com/user-attachments/assets/28172e5a-1401-44da-a95c-86711f5f1870)


